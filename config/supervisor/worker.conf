; =============================================================================
; NimbusDocs Notifications Worker - Supervisor Configuration
; =============================================================================
; 
; Este arquivo configura o supervisor para rodar o worker de notificações
; como um processo daemon em servidores Linux.
;
; Instalação:
;   1. Copie este arquivo para /etc/supervisor/conf.d/nimbusdocs-worker.conf
;   2. Execute: supervisorctl reread && supervisorctl update
;   3. Verifique: supervisorctl status nimbusdocs-worker
;
; Logs:
;   - stdout: /var/log/nimbusdocs/worker.log
;   - stderr: /var/log/nimbusdocs/worker-error.log
;
; =============================================================================

[program:nimbusdocs-worker]
; Comando para executar o worker
command=php /var/www/nimbusdocs/bin/notifications-worker.php

; Diretório de trabalho
directory=/var/www/nimbusdocs

; Usuário que executa o processo (ajuste conforme seu ambiente)
user=www-data

; Número de processos (1 é suficiente para a maioria dos casos)
numprocs=1

; Reiniciar automaticamente se parar
autorestart=true

; Esperar 5 segundos antes de considerar iniciado com sucesso
startsecs=5

; Número de tentativas de restart antes de desistir
startretries=3

; Sinal para parar o processo (SIGTERM permite graceful shutdown)
stopsignal=TERM

; Tempo máximo para shutdown graceful (segundos)
stopwaitsecs=30

; Redirecionar stderr para stdout
redirect_stderr=false

; Arquivos de log
stdout_logfile=/var/log/nimbusdocs/worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5

stderr_logfile=/var/log/nimbusdocs/worker-error.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=3

; Variáveis de ambiente (descomente e ajuste conforme necessário)
; environment=
;     WORKER_SLEEP_SECONDS="5",
;     WORKER_BATCH_SIZE="20",
;     OUTBOX_RESCUE_MINUTES="30"
